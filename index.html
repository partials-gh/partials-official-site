<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Partials · HTML Previewer</title>
<link rel="icon" type="image/png" href="images/icon.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;1,300&family=Fraunces:ital,opsz,wght@0,9..144,200;0,9..144,300;1,9..144,200&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0e0e10;
    --surface: #16161a;
    --surface2: #1c1c21;
    --border: #2a2a30;
    --border-strong: #3a3a44;
    --text: #e8e6e0;
    --text-muted: #5c5c6a;
    --text-dim: #3c3c48;
    --accent: #4ade80;
    --accent-dim: #1a3325;
    --tag: #232328;
    --mono: 'DM Mono', monospace;
    --serif: 'Fraunces', serif;
  }

  html, body {
    height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: var(--mono);
    font-size: 13px;
    line-height: 1.6;
    overflow: hidden;
  }

  body { -webkit-user-select: none; user-select: none; }
  #editor { -webkit-user-select: text !important; user-select: text !important; }

  nav {
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 100;
    height: 48px;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 20px;
  }

  .nav-brand {
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
    color: var(--text);
    flex-shrink: 0;
  }

  .nav-logo {
    width: 24px; height: 24px;
    border-radius: 5px;
    overflow: hidden;
    background: var(--surface2);
    display: grid;
    place-items: center;
    flex-shrink: 0;
  }

  .nav-logo img {
    width: 100%; height: 100%;
    object-fit: cover;
    display: block;
  }

  .nav-logo .fallback {
    font-family: var(--serif);
    font-size: 11px;
    font-weight: 200;
    color: var(--accent);
  }

  .nav-title {
    font-family: var(--serif);
    font-weight: 200;
    font-size: 15px;
    letter-spacing: -0.3px;
  }

  .nav-version {
    font-size: 10px;
    color: var(--text-muted);
    background: var(--tag);
    padding: 2px 7px;
    border-radius: 20px;
    margin-left: 6px;
    letter-spacing: 0.3px;
    border: 1px solid var(--border);
  }

  .nav-divider {
    width: 1px; height: 20px;
    background: var(--border);
    margin: 0 16px;
  }

  .nav-links {
    display: flex;
    align-items: center;
    gap: 2px;
    flex: 1;
  }

  .nav-link {
    text-decoration: none;
    color: var(--text-muted);
    padding: 5px 10px;
    border-radius: 6px;
    font-size: 12px;
    font-family: var(--mono);
    transition: color 0.15s, background 0.15s;
    display: flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    border: none;
    background: none;
  }

  .nav-link:hover { color: var(--text); background: var(--surface2); }

  .dropdown { position: relative; }

  .dropdown-menu {
    display: none;
    position: absolute;
    top: calc(100% + 6px);
    left: 0;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 6px;
    min-width: 168px;
    box-shadow: 0 12px 36px rgba(0,0,0,0.6);
    z-index: 200;
  }

  .dropdown:hover .dropdown-menu { display: block; }

  .dropdown-item {
    display: block;
    text-decoration: none;
    color: var(--text-muted);
    padding: 7px 12px;
    border-radius: 6px;
    font-size: 12px;
    font-family: var(--mono);
    transition: all 0.12s;
  }

  .dropdown-item:hover { color: var(--text); background: var(--surface2); }

  .dropdown-label {
    font-size: 10px;
    color: var(--text-dim);
    padding: 5px 12px 3px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
  }

  .nav-right {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: auto;
  }

  .github-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    text-decoration: none;
    color: var(--text-muted);
    padding: 5px 10px;
    border-radius: 6px;
    font-size: 12px;
    font-family: var(--mono);
    border: 1px solid var(--border);
    transition: all 0.15s;
  }

  .github-btn:hover { color: var(--text); border-color: var(--border-strong); background: var(--surface2); }
  .github-icon { width: 14px; height: 14px; fill: currentColor; flex-shrink: 0; }

  /* TOOLBAR */
  .toolbar {
    position: fixed;
    top: 48px; left: 0; right: 0;
    z-index: 90;
    height: 42px;
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 16px;
    gap: 6px;
  }

  .toolbar-label {
    font-size: 11px;
    color: var(--text-dim);
    letter-spacing: 0.5px;
    text-transform: uppercase;
    margin-right: 4px;
  }

  .view-toggle {
    display: flex;
    background: var(--bg);
    border-radius: 7px;
    padding: 3px;
    gap: 2px;
    border: 1px solid var(--border);
  }

  .view-btn {
    padding: 4px 12px;
    border-radius: 5px;
    border: none;
    background: none;
    font-family: var(--mono);
    font-size: 11px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.15s;
  }

  .view-btn.active {
    background: var(--surface2);
    color: var(--text);
    box-shadow: 0 1px 4px rgba(0,0,0,0.5);
  }

  .toolbar-sep { width: 1px; height: 20px; background: var(--border); margin: 0 8px; }

  .run-btn {
    display: flex;
    align-items: center;
    gap: 7px;
    padding: 5px 16px;
    border-radius: 7px;
    border: none;
    background: var(--accent);
    color: #061208;
    font-family: var(--mono);
    font-size: 11px;
    cursor: pointer;
    transition: all 0.15s;
    margin-left: auto;
    font-weight: 400;
  }

  .run-btn:hover { filter: brightness(1.1); transform: translateY(-1px); box-shadow: 0 4px 16px rgba(74,222,128,0.2); }

  .run-icon {
    width: 0; height: 0;
    border-left: 7px solid currentColor;
    border-top: 4px solid transparent;
    border-bottom: 4px solid transparent;
  }

  .clear-btn {
    padding: 5px 12px;
    border-radius: 7px;
    border: 1px solid var(--border);
    background: none;
    font-family: var(--mono);
    font-size: 11px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.15s;
  }

  .clear-btn:hover { border-color: var(--border-strong); color: var(--text); background: var(--surface2); }

  /* APP */
  .app {
    position: fixed;
    top: 90px; left: 0; right: 0; bottom: 24px;
    display: flex;
  }

  .editor-pane {
    width: 50%;
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--border);
    position: relative;
    min-width: 0;
  }

  .pane-header {
    padding: 9px 16px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--surface);
    flex-shrink: 0;
  }

  .pane-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent); opacity: 0.6; }

  .pane-title {
    font-size: 11px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.8px;
  }

  .line-count { margin-left: auto; font-size: 10px; color: var(--text-dim); }

  .editor-wrap {
    flex: 1;
    display: flex;
    overflow: hidden;
  }

  .line-numbers {
    padding: 14px 10px 14px 0;
    width: 44px;
    text-align: right;
    color: var(--text-dim);
    font-size: 12px;
    line-height: 1.7;
    border-right: 1px solid var(--border);
    background: var(--bg);
    overflow: hidden;
    flex-shrink: 0;
    user-select: none !important;
    -webkit-user-select: none !important;
  }

  #editor {
    flex: 1;
    padding: 14px 16px;
    border: none;
    outline: none;
    resize: none;
    background: var(--surface);
    color: var(--text);
    font-family: var(--mono);
    font-size: 12.5px;
    line-height: 1.7;
    tab-size: 2;
    white-space: pre;
    overflow-wrap: normal;
    overflow: auto;
    caret-color: var(--accent);
  }

  #editor::placeholder { color: var(--text-dim); }
  #editor:focus { background: #17171c; }

  .preview-pane {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-width: 0;
  }

  #preview {
    flex: 1;
    border: none;
    background: white;
  }

  /* RESIZE HANDLE — fixed */
  .resize-handle {
    position: absolute;
    top: 0; right: -4px; bottom: 0;
    width: 8px;
    cursor: col-resize;
    z-index: 50;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .resize-handle::after {
    content: '';
    width: 2px;
    height: 36px;
    border-radius: 2px;
    background: var(--border);
    transition: background 0.15s, height 0.15s;
  }

  .resize-handle:hover::after { background: var(--accent); height: 52px; }
  .resize-dragging .resize-handle::after { background: var(--accent); height: 52px; }

  /* VIEW MODES */
  .app.editor-only .preview-pane { display: none; }
  .app.editor-only .editor-pane { width: 100% !important; }
  .app.preview-only .editor-pane { display: none; }
  .app.preview-only .preview-pane { display: flex; width: 100%; }

  /* STATUS BAR */
  .status-bar {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    height: 24px;
    background: #0a0a0c;
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 16px;
    gap: 16px;
    z-index: 100;
  }

  .status-item {
    font-size: 10px;
    color: var(--text-dim);
    display: flex;
    align-items: center;
    gap: 5px;
    letter-spacing: 0.3px;
  }

  .status-item.live { color: var(--accent); opacity: 0.8; }
  .status-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--accent); }

  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.25} }
  .status-item.live .status-dot { animation: pulse 2s ease-in-out infinite; }

  /* CONTEXT MENU */
  #ctx-menu {
    position: fixed;
    z-index: 9999;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 6px;
    min-width: 196px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.7), 0 0 0 1px rgba(255,255,255,0.04) inset;
    display: none;
    pointer-events: all;
  }

  #ctx-menu.visible {
    display: block;
    animation: ctxIn 0.12s cubic-bezier(0.2,0,0,1);
  }

  @keyframes ctxIn {
    from { opacity: 0; transform: scale(0.94) translateY(-6px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
  }

  .ctx-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    border-radius: 7px;
    font-family: var(--mono);
    font-size: 12px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.1s;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
  }

  .ctx-item:hover { color: var(--text); background: var(--surface2); }
  .ctx-item.green:hover { color: var(--accent); background: var(--accent-dim); }

  .ctx-icon { width: 14px; height: 14px; opacity: 0.6; flex-shrink: 0; }

  .ctx-sep { height: 1px; background: var(--border); margin: 4px 0; }

  .ctx-kbd {
    margin-left: auto;
    font-size: 10px;
    color: var(--text-dim);
    background: var(--bg);
    padding: 2px 5px;
    border-radius: 4px;
    border: 1px solid var(--border);
    white-space: nowrap;
  }

  /* FIX OVERLAY */
  .fix-overlay {
    position: absolute;
    inset: 0;
    background: rgba(14,14,16,0.88);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 20;
    gap: 10px;
    flex-direction: column;
    backdrop-filter: blur(6px);
  }

  .fix-overlay.visible { display: flex; }
  .fix-msg { font-size: 12px; color: var(--text-muted); }
  .fix-spinner {
    width: 20px; height: 20px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
  }

  @keyframes spin { to { transform: rotate(360deg); } }
  @keyframes fadeSlideIn { from{opacity:0;transform:translateY(5px)} to{opacity:1;transform:translateY(0)} }

  nav { animation: fadeSlideIn 0.35s ease both; }
  .toolbar { animation: fadeSlideIn 0.35s ease 0.05s both; }
  .app { animation: fadeSlideIn 0.35s ease 0.1s both; }

  @media (max-width: 640px) {
    .nav-links, .nav-divider { display: none; }
    .editor-pane { width: 100% !important; }
    .preview-pane { display: none; }
    .app.preview-only .editor-pane { display: none; }
    .app.preview-only .preview-pane { display: flex; width: 100%; }
  }
</style>
</head>
<body>

<nav>
  <a href="#" class="nav-brand">
    <div class="nav-logo" id="nav-logo-wrap">
      <img src="images/icon.png" alt="Partials" id="nav-icon" onerror="document.getElementById('nav-icon').style.display='none';document.getElementById('nav-fallback').style.display='block'">
      <span class="fallback" id="nav-fallback" style="display:none">P</span>
    </div>
    <span class="nav-title">Partials</span>
    <span class="nav-version">v1.2</span>
  </a>

  <div class="nav-divider"></div>

  <div class="nav-links">
    <a href="#" class="nav-link">About</a>

    <div class="dropdown">
      <button class="nav-link">Tools <svg width="8" height="5" viewBox="0 0 8 5" fill="none" style="opacity:0.4"><path d="M1 1l3 3 3-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      <div class="dropdown-menu">
        <div class="dropdown-label">Tools</div>
        <a href="#" class="dropdown-item">Calculator</a>
        <a href="#" class="dropdown-item">Partials AI</a>
        <a href="#" class="dropdown-item">Chat Bubble</a>
      </div>
    </div>

    <a href="#" class="nav-link">Games</a>

    <div class="dropdown">
      <button class="nav-link">Templates <svg width="8" height="5" viewBox="0 0 8 5" fill="none" style="opacity:0.4"><path d="M1 1l3 3 3-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
      <div class="dropdown-menu">
        <div class="dropdown-label">Templates</div>
        <a href="#" class="dropdown-item">AI Template</a>
        <a href="#" class="dropdown-item">Calculator Template</a>
        <a href="#" class="dropdown-item">Portfolio Template</a>
      </div>
    </div>

    <a href="#" class="nav-link">Portfolio</a>
  </div>

  <div class="nav-right">
    <a href="https://github.com/partials-gh" target="_blank" class="github-btn">
      <svg class="github-icon" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
      GitHub
    </a>
  </div>
</nav>

<div class="toolbar">
  <span class="toolbar-label">View</span>
  <div class="view-toggle">
    <button class="view-btn" id="btn-editor" onclick="setView('editor')">Editor</button>
    <button class="view-btn active" id="btn-split" onclick="setView('split')">Split</button>
    <button class="view-btn" id="btn-preview" onclick="setView('preview')">Preview</button>
  </div>
  <div class="toolbar-sep"></div>
  <button class="clear-btn" onclick="clearEditor()">Clear</button>
  <button class="run-btn" onclick="runPreview()">
    <span class="run-icon"></span>
    Run
  </button>
</div>

<div class="app" id="app">
  <div class="editor-pane" id="editor-pane">
    <div class="pane-header">
      <div class="pane-dot"></div>
      <span class="pane-title">HTML Source</span>
      <span class="line-count" id="line-count">2 lines</span>
    </div>
    <div class="editor-wrap">
      <div class="line-numbers" id="line-numbers">1<br>2</div>
      <textarea id="editor" spellcheck="false" placeholder="Write HTML here…"><h1>Welcome</h1>
<p>Start building something.</p></textarea>
    </div>
    <div class="fix-overlay" id="fix-overlay">
      <div class="fix-spinner"></div>
      <span class="fix-msg">Fixing code…</span>
    </div>
    <div class="resize-handle" id="resize-handle"></div>
  </div>

  <div class="preview-pane" id="preview-pane">
    <div class="pane-header">
      <div class="pane-dot" style="background:#a78bfa;opacity:0.6"></div>
      <span class="pane-title">Preview</span>
    </div>
    <iframe id="preview" sandbox="allow-scripts allow-same-origin"></iframe>
  </div>
</div>

<div class="status-bar">
  <div class="status-item live">
    <div class="status-dot"></div>
    <span>Live</span>
  </div>
  <div class="status-item"><span>Partials HTML Previewer</span></div>
  <div class="status-item" style="margin-left:auto"><span id="char-count">0 chars</span></div>
  <div class="status-item"><span>est. 2026</span></div>
</div>

<!-- CUSTOM RIGHT-CLICK MENU -->
<div id="ctx-menu" role="menu">
  <button class="ctx-item green" onclick="fixCode()">
    <svg class="ctx-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/>
    </svg>
    Fix Code
    <span class="ctx-kbd">auto</span>
  </button>
  <button class="ctx-item" onclick="runPreview(); closeCtx()">
    <svg class="ctx-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <polygon points="5 3 19 12 5 21 5 3"/>
    </svg>
    Run Preview
    <span class="ctx-kbd">ctrl+↵</span>
  </button>
  <div class="ctx-sep"></div>
  <button class="ctx-item" onclick="saveHTML()">
    <svg class="ctx-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>
    </svg>
    Save HTML as…
    <span class="ctx-kbd">index.html</span>
  </button>
</div>

<script>
  /* ── BLOCK DEVTOOLS ── */
  document.addEventListener('contextmenu', e => { e.preventDefault(); showCtx(e.clientX, e.clientY); });

  document.addEventListener('keydown', e => {
    if (e.key === 'F12') { e.preventDefault(); return; }
    if (e.ctrlKey && e.shiftKey && ['I','J','C','K'].includes(e.key.toUpperCase())) { e.preventDefault(); return; }
    if (e.ctrlKey && e.key.toLowerCase() === 'u') { e.preventDefault(); return; }
  });

  /* devtools size probe */
  setInterval(() => {
    if (window.outerWidth - window.innerWidth > 200 || window.outerHeight - window.innerHeight > 200) {
      document.body.style.display = 'none';
      document.title = 'close devtools';
    } else {
      if (document.body.style.display === 'none') {
        document.body.style.display = '';
        document.title = 'Partials · HTML Previewer';
      }
    }
  }, 800);

  /* ── CONTEXT MENU ── */
  const ctxMenu = document.getElementById('ctx-menu');

  function showCtx(x, y) {
    ctxMenu.classList.add('visible');
    const w = 200, h = 140;
    ctxMenu.style.left = Math.min(x, window.innerWidth - w - 8) + 'px';
    ctxMenu.style.top  = Math.min(y, window.innerHeight - h - 8) + 'px';
  }

  function closeCtx() { ctxMenu.classList.remove('visible'); }

  document.addEventListener('mousedown', e => {
    if (!ctxMenu.contains(e.target)) closeCtx();
  });

  document.addEventListener('keydown', e => { if (e.key === 'Escape') closeCtx(); });

  /* ── SAVE HTML ── */
  function saveHTML() {
    closeCtx();
    const blob = new Blob([editor.value], { type: 'text/html;charset=utf-8' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'index.html';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(a.href);
  }

  /* ── FIX CODE ── */
  function fixCode() {
    closeCtx();
    const overlay = document.getElementById('fix-overlay');
    overlay.classList.add('visible');
    setTimeout(() => {
      try {
        const raw = editor.value.trim();
        const parser = new DOMParser();
        const parsed = parser.parseFromString(raw, 'text/html');
        let fixed;
        if (raw.toLowerCase().includes('<!doctype') || raw.toLowerCase().includes('<html')) {
          fixed = '<!DOCTYPE html>\n<html lang="en">\n<head>\n' + parsed.head.innerHTML.trim() + '\n</head>\n<body>\n' + parsed.body.innerHTML.trim() + '\n</body>\n</html>';
        } else {
          fixed = parsed.body.innerHTML.trim();
        }
        editor.value = fixed;
        runPreview();
        updateLineNumbers();
      } catch(err) { /* silent */ }
      overlay.classList.remove('visible');
    }, 900);
  }

  /* ── EDITOR ── */
  const editor     = document.getElementById('editor');
  const preview    = document.getElementById('preview');
  const lineNums   = document.getElementById('line-numbers');
  const lineCount  = document.getElementById('line-count');
  const charCount  = document.getElementById('char-count');
  const app        = document.getElementById('app');

  let debounceTimer;

  function runPreview() {
    preview.srcdoc = editor.value;
  }

  editor.addEventListener('input', () => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(runPreview, 280);
    updateLineNumbers();
  });

  editor.addEventListener('scroll', () => {
    lineNums.scrollTop = editor.scrollTop;
  });

  function updateLineNumbers() {
    const lines = editor.value.split('\n');
    lineCount.textContent = lines.length + (lines.length === 1 ? ' line' : ' lines');
    charCount.textContent = editor.value.length.toLocaleString() + ' chars';
    lineNums.innerHTML = lines.map((_,i) => i+1).join('<br>');
  }

  editor.addEventListener('keydown', e => {
    if (e.key === 'Tab') {
      e.preventDefault();
      const s = editor.selectionStart, end = editor.selectionEnd;
      editor.value = editor.value.slice(0, s) + '  ' + editor.value.slice(end);
      editor.selectionStart = editor.selectionEnd = s + 2;
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(runPreview, 280);
      updateLineNumbers();
    }
    if (e.ctrlKey && e.key === 'Enter') runPreview();
  });

  /* ── VIEW MODES ── */
  function setView(mode) {
    app.className = 'app';
    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
    if (mode === 'editor') {
      app.classList.add('editor-only');
      document.getElementById('btn-editor').classList.add('active');
    } else if (mode === 'preview') {
      app.classList.add('preview-only');
      document.getElementById('btn-preview').classList.add('active');
    } else {
      document.getElementById('btn-split').classList.add('active');
    }
  }

  function clearEditor() {
    if (!editor.value.trim()) return;
    if (confirm('Clear all content?')) {
      editor.value = '';
      runPreview();
      updateLineNumbers();
    }
  }

  /* ── RESIZE (FIXED) ──
     Key fix: disable pointer-events on everything except the overlay div
     so the mouse can't "escape" to the iframe or other elements.          */
  const handle     = document.getElementById('resize-handle');
  const editorPane = document.getElementById('editor-pane');
  let isResizing   = false;

  /* Overlay that captures all mouse events during drag */
  const dragOverlay = document.createElement('div');
  dragOverlay.style.cssText = 'position:fixed;inset:0;z-index:9000;cursor:col-resize;display:none';
  document.body.appendChild(dragOverlay);

  handle.addEventListener('mousedown', e => {
    e.preventDefault();
    isResizing = true;
    dragOverlay.style.display = 'block';
    handle.classList.add('dragging');
  });

  dragOverlay.addEventListener('mousemove', e => {
    if (!isResizing) return;
    const rect = app.getBoundingClientRect();
    const pct  = ((e.clientX - rect.left) / rect.width) * 100;
    editorPane.style.width = Math.max(20, Math.min(80, pct)) + '%';
  });

  dragOverlay.addEventListener('mouseup', () => {
    isResizing = false;
    dragOverlay.style.display = 'none';
    handle.classList.remove('dragging');
  });

  /* Safety: also catch mouseup on document in case cursor flew past overlay */
  document.addEventListener('mouseup', () => {
    if (isResizing) {
      isResizing = false;
      dragOverlay.style.display = 'none';
      handle.classList.remove('dragging');
    }
  });

  /* ── INIT ── */
  updateLineNumbers();
  runPreview();
</script>
</body>
</html>
